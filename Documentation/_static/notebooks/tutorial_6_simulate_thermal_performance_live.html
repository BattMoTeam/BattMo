<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2022a"><title>Tutorial 6 - Simulate Thermal Performance</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(192, 76, 11); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 20px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.S2 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S3 { margin: 10px 0px 20px; padding-left: 0px; font-family: Helvetica, Arial, sans-serif; font-size: 14px;  }
.S4 { margin-left: 56px; line-height: 21px; min-height: 0px; text-align: left; white-space: pre-wrap;  }
.CodeBlock { background-color: #F5F5F5; margin: 10px 0 10px 0; }
.S5 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 1px solid rgb(191, 191, 191); border-bottom: 1px solid rgb(191, 191, 191); border-radius: 4px; padding: 6px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S6 { margin: 10px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S7 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 1px solid rgb(191, 191, 191); border-bottom: 0px none rgb(33, 33, 33); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S8 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S9 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 0px none rgb(33, 33, 33); border-bottom: 1px solid rgb(191, 191, 191); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span>Tutorial 6 - Simulate Thermal Performance</span></h1><h2  class = 'S1'><span>Introduction</span></h2><div  class = 'S2'><span>In this tutorial, we will use a P2D model to simulate the thermal performance of a battery cell. After completing this tutorial, you should have a working knowledge of:</span></div><ul  class = 'S3'><li  class = 'S4'><span>Basics of how material properties are defined in BattMo</span></li></ul><div  class = 'S2'><span>We'll use the same model from Tutorial 1.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >jsonstruct = parseBattmoJson(</span><span style="color: rgb(167, 9, 245);">'Examples/jsondatafiles/sample_input.json'</span><span >);</span></span></div></div></div><div  class = 'S6'><span>Parameters are defined in the JSON parameter file and parsed into the MATLAB structure. Once the JSON file has been read into MATLAB as a jsonstruct, its properties can be modified programmatically. </span></div><h2  class = 'S1'><span>Explore the Material Parameters</span></h2><div  class = 'S2'><span>Let's begin by exploring the active material of the positive electrode coating with the following command:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >disp(jsonstruct.PositiveElectrode.Coating.ActiveMaterial)</span></span></div></div></div><div  class = 'S6'><span>We can see that a variety of parameters are defined that determine the physicochemical properties of the material. Many of the parameters that describe the electrochemical reactions that take place at the active material - electrolyte interface are contained in the Interface structure, which we can explore with the command:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >disp(jsonstruct.PositiveElectrode.Coating.ActiveMaterial.Interface)</span></span></div></div></div><div  class = 'S6'><span>Furthermore, it is well known that the diffusion of lithium in the active materials can be a limiting factor in Li-ion battery performance. The diffusion model used in this simulation can be explored with the following command:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >disp(jsonstruct.PositiveElectrode.Coating.ActiveMaterial.SolidDiffusion)</span></span></div></div></div><div  class = 'S6'><span>We can see there that the solid diffusion model includes a reference diffusion coefficient, activation energy of diffusion, and the effective particle radius.</span></div><h2  class = 'S1'><span>Make a Simple Change</span></h2><div  class = 'S2'><span>Let's make a simple change to the positive electrode active material properties in our model and see how it affects the results. Let's compare how c</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% create a vector of diffent thickness values</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >radius = [1, 5, 10].*1e-6;</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% instantiate and empty cell array to store the outputs of the simulations</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >output = cell(size(radius));</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% instantiate an empty figure</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >figure()</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% use a for-loop to iterate through the vector of c-rates</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">for </span><span >i = 1 : numel(radius)</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% modify the value for the c-rate in the control definition and update</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% the total duration of the simulation accordingly</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    jsonstruct.PositiveElectrode.Coating.ActiveMaterial.SolidDiffusion.particleRadius = radius(i);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% run the simulation and store the results in the output cell array</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    output{i} = runBatteryJson(jsonstruct);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% retrieve the states from the simulation result</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    states = output{i}.states;</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% extract the time and voltage quantities</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    time = cellfun(@(state) state.time, states);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    voltage = cellfun(@(state) state.(</span><span style="color: rgb(167, 9, 245);">'Control'</span><span >).E, states);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    current = cellfun(@(state) state.(</span><span style="color: rgb(167, 9, 245);">'Control'</span><span >).I, states);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% calculate the capacity</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    capacity = time .* current;</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% plot the discharge curve in the figure</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    plot((capacity/(milli*hour)), voltage, </span><span style="color: rgb(167, 9, 245);">'-'</span><span >, </span><span style="color: rgb(167, 9, 245);">'linewidth'</span><span >, 3)</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    hold </span><span style="color: rgb(167, 9, 245);">on</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >hold </span><span style="color: rgb(167, 9, 245);">off</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'Capacity  /  mA \cdot h'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'Cell Voltage  /  V'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >legend(</span><span style="color: rgb(167, 9, 245);">'r = 1 µm'</span><span >, </span><span style="color: rgb(167, 9, 245);">'r = 5 µm'</span><span >, </span><span style="color: rgb(167, 9, 245);">'r = 10 µm'</span><span >)</span></span></div></div></div><h2  class = 'S1'><span>Swap Active Materials</span></h2><div  class = 'S2'><span>Now let's try to replace the active material with a different material from the BattMo library. In this example, we will replace the NMC material with LFP. First, let's re-load our baseline example parameter set to get rid of the changes from the previous sections. </span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >clear</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >jsonstruct = parseBattmoJson(</span><span style="color: rgb(167, 9, 245);">'Examples/jsondatafiles/sample_input.json'</span><span >);</span></span></div></div></div><div  class = 'S6'><span>Now we load and parse the LFP material parameters from the </span><span style=' font-weight: bold;'>BattMo</span><span> library and move it to the right place in the model hierarchy:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >lfp = parseBattmoJson(</span><span style="color: rgb(167, 9, 245);">'ParameterData/MaterialProperties/LFP/LFP.json'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >jsonstruct_lfp.PositiveElectrode.Coating.ActiveMaterial.Interface = lfp;</span></span></div></div></div><div  class = 'S6'><span>To merge new parameter data into our existing model, we can use the </span><span style=' font-weight: bold;'>BattMo</span><span> function </span><span style=' font-family: monospace;'>mergeJsonStructs</span><span>.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >jsonstruct = mergeJsonStructs({jsonstruct_lfp, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >                              jsonstruct});</span></span></div></div></div><div  class = 'S6'><span>We need to be sure that the parameters are consistent across the hierarchy:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >jsonstruct.PositiveElectrode.Coating.ActiveMaterial.density = jsonstruct.PositiveElectrode.Coating.ActiveMaterial.Interface.density;</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >jsonstruct.PositiveElectrode.Coating.effectiveDensity = 900;</span></span></div></div></div><div  class = 'S6'><span>And now, we can run the simulation and plot the discharge curve:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% run the simulation</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >output = runBatteryJson(jsonstruct);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% get the states</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >states = output.states;</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% extract the time and voltage quantities</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >time = cellfun(@(state) state.time, states);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >voltage = cellfun(@(state) state.(</span><span style="color: rgb(167, 9, 245);">'Control'</span><span >).E, states);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >current = cellfun(@(state) state.(</span><span style="color: rgb(167, 9, 245);">'Control'</span><span >).I, states);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% calculate the capacity</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >capacity = time .* current;</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% plot the discharge curve in the figure</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >plot((capacity/(milli*hour)), voltage, </span><span style="color: rgb(167, 9, 245);">'-'</span><span >, </span><span style="color: rgb(167, 9, 245);">'linewidth'</span><span >, 3)</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'Capacity  /  mA \cdot h'</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'Cell Voltage  /  V'</span><span >)</span></span></div></div></div><h2  class = 'S1'><span>Summary</span></h2><div  class = 'S2'><span>In this tutorial, we explored how to modify material parameters in BattMo.</span></div><div  class = 'S2'><span></span></div><div  class = 'S2'><span></span></div><div  class = 'S2'><span></span></div><div  class = 'S2'><span></span></div><div  class = 'S2'></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Tutorial 6 - Simulate Thermal Performance
%% Introduction
% In this tutorial, we will use a P2D model to simulate the thermal performance 
% of a battery cell. After completing this tutorial, you should have a working 
% knowledge of:
%% 
% * Basics of how material properties are defined in BattMo
%% 
% We'll use the same model from Tutorial 1.

jsonstruct = parseBattmoJson('Examples/jsondatafiles/sample_input.json');
%% 
% Parameters are defined in the JSON parameter file and parsed into the MATLAB 
% structure. Once the JSON file has been read into MATLAB as a jsonstruct, its 
% properties can be modified programmatically. 
%% Explore the Material Parameters
% Let's begin by exploring the active material of the positive electrode coating 
% with the following command:

disp(jsonstruct.PositiveElectrode.Coating.ActiveMaterial)
%% 
% We can see that a variety of parameters are defined that determine the physicochemical 
% properties of the material. Many of the parameters that describe the electrochemical 
% reactions that take place at the active material - electrolyte interface are 
% contained in the Interface structure, which we can explore with the command:

disp(jsonstruct.PositiveElectrode.Coating.ActiveMaterial.Interface)
%% 
% Furthermore, it is well known that the diffusion of lithium in the active 
% materials can be a limiting factor in Li-ion battery performance. The diffusion 
% model used in this simulation can be explored with the following command:

disp(jsonstruct.PositiveElectrode.Coating.ActiveMaterial.SolidDiffusion)
%% 
% We can see there that the solid diffusion model includes a reference diffusion 
% coefficient, activation energy of diffusion, and the effective particle radius.
%% Make a Simple Change
% Let's make a simple change to the positive electrode active material properties 
% in our model and see how it affects the results. Let's compare how c

% create a vector of diffent thickness values
radius = [1, 5, 10].*1e-6;

% instantiate and empty cell array to store the outputs of the simulations
output = cell(size(radius));

% instantiate an empty figure
figure()

% use a for-loop to iterate through the vector of c-rates
for i = 1 : numel(radius)
    % modify the value for the c-rate in the control definition and update
    % the total duration of the simulation accordingly
    jsonstruct.PositiveElectrode.Coating.ActiveMaterial.SolidDiffusion.particleRadius = radius(i);

    % run the simulation and store the results in the output cell array
    output{i} = runBatteryJson(jsonstruct);

    % retrieve the states from the simulation result
    states = output{i}.states;

    % extract the time and voltage quantities
    time = cellfun(@(state) state.time, states);
    voltage = cellfun(@(state) state.('Control').E, states);
    current = cellfun(@(state) state.('Control').I, states);

    % calculate the capacity
    capacity = time .* current;
    
    % plot the discharge curve in the figure
    plot((capacity/(milli*hour)), voltage, '-', 'linewidth', 3)
    hold on
end
hold off
xlabel('Capacity  /  mA \cdot h')
ylabel('Cell Voltage  /  V')
legend('r = 1 µm', 'r = 5 µm', 'r = 10 µm')
%% Swap Active Materials
% Now let's try to replace the active material with a different material from 
% the BattMo library. In this example, we will replace the NMC material with LFP. 
% First, let's re-load our baseline example parameter set to get rid of the changes 
% from the previous sections. 

clear
jsonstruct = parseBattmoJson('Examples/jsondatafiles/sample_input.json');
%% 
% Now we load and parse the LFP material parameters from the *BattMo* library 
% and move it to the right place in the model hierarchy:

lfp = parseBattmoJson('ParameterData/MaterialProperties/LFP/LFP.json');
jsonstruct_lfp.PositiveElectrode.Coating.ActiveMaterial.Interface = lfp;
%% 
% To merge new parameter data into our existing model, we can use the *BattMo* 
% function |mergeJsonStructs|.

jsonstruct = mergeJsonStructs({jsonstruct_lfp, ...
                              jsonstruct});
%% 
% We need to be sure that the parameters are consistent across the hierarchy:

jsonstruct.PositiveElectrode.Coating.ActiveMaterial.density = jsonstruct.PositiveElectrode.Coating.ActiveMaterial.Interface.density;
jsonstruct.PositiveElectrode.Coating.effectiveDensity = 900;
%% 
% And now, we can run the simulation and plot the discharge curve:

% run the simulation
output = runBatteryJson(jsonstruct);
% get the states
states = output.states;

% extract the time and voltage quantities
time = cellfun(@(state) state.time, states);
voltage = cellfun(@(state) state.('Control').E, states);
current = cellfun(@(state) state.('Control').I, states);

% calculate the capacity
capacity = time .* current;

% plot the discharge curve in the figure
plot((capacity/(milli*hour)), voltage, '-', 'linewidth', 3)
xlabel('Capacity  /  mA \cdot h')
ylabel('Cell Voltage  /  V')
%% Summary
% In this tutorial, we explored how to modify material parameters in BattMo.
% 
% 
% 
% 
% 
% 
% 
% 
% 
%
##### SOURCE END #####
-->
</div></body></html>
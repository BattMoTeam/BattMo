classdef Graphite < ActiveMaterial

    methods

        function model = Graphite(paramobj)
            
            model = model@ActiveMaterial(paramobj);
            
        end
        
        function state = updateOCP(model, state)
        % Calculate the solid diffusion coefficient of Li+ in the active material Calculate the solid phase diffusion
        % coefficient of Li+ in graphite according to the model used by Torchio et al [1].
            
            refT = 298.15;  % [K]

            T = state.T;
            c = state.c;

            % Calculate the lithiation of the active material. This
            % is a simplification for the initial code! The "real"
            % value of theta should be calculated using the surface
            % concentration of Li and the maximum lithium
            % concentration:
            %
            theta = c ./ model.Li.cmax;
            
            % Calculate the open-circuit potential at the reference temperature for the given lithiation
            refOCP = (0.7222 ...
                      + 0.1387 .* theta ...
                      + 0.0290 .* theta.^0.5 ...
                      - 0.0172 ./ theta ... 
                      + 0.0019 ./ theta.^1.5 ...
                      + 0.2808 .* exp(0.9 - 15.*theta) ... 
                      - 0.7984 .* exp(0.4465.*theta - 0.4108));
                  
            coeff1 = [0.005269056 ,...
                      + 3.299265709,...
                      - 91.79325798,...
                      + 1004.911008,...
                      - 5812.278127,...
                      + 19329.75490,...
                      - 37147.89470,...
                      + 38379.18127,...
                      - 16515.05308];
               
            coeff2= [1, ...
                     - 48.09287227,...
                     + 1017.234804,...
                     - 10481.80419,...
                     + 59431.30000,...
                     - 195881.6488,...
                     + 374577.3152,...
                     - 385821.1607,...
                     + 165705.8597];
            
            dUdT = 1e-3.*polyval(coeff1(end:-1:1),theta)./ polyval(coeff2(end:-1:1),theta);

            % Calculate the open-circuit potential of the active material
            OCP = refOCP + (T - refT) .* dUdT;
            
            state.OCP = OCP;
            
        end
        
    end
end

%% References
%   [1] Torchio et al, Journal of The Electrochemical Society, 163 (7)
%   A1192-A1205 (2016), DOI: 10.1149/2.0291607jes


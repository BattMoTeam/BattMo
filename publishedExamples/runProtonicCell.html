

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PEM electrolyser with Gas Supply &mdash; BattMo  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css?v=226d88b4" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=c92655ae" />

  
    <link rel="shortcut icon" href="../_static/battmologo.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"loader": {"load": ["[tex]/mhchem"]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "packages": {"[+]": ["mhchem"]}}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="BattMoApp" href="../app.html" />
    <link rel="prev" title="Gas Supply Layer" href="runGasSupply.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            BattMo
              <img src="../_static/battmologo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#update-existing-installation">Update existing installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basicusage.html">Basic Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#a-first-battmo-model">A First <strong>BattMo</strong> Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#define-parameters">Define Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#run-simulation">Run Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#show-the-dashboard">Show the Dashboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#explore-the-output">Explore the Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#explore-the-grid">Explore the Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#explore-the-states">Explore the States</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#plot-a-result">Plot a Result</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#change-control-parameters">Change Control Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#change-structural-parameters">Change Structural Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#change-material-parameters">Change Material Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#notebooks">Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pynbnotebooks/tutorial_1_a_simple_p2d_model_live.html">Tutorial 1 - Your First BattMo Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_1_a_simple_p2d_model_live.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_1_a_simple_p2d_model_live.html#Define-Parameters">Define Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_1_a_simple_p2d_model_live.html#Run-Simulation">Run Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_1_a_simple_p2d_model_live.html#Show-the-Dashboard">Show the Dashboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_1_a_simple_p2d_model_live.html#Explore-the-Output">Explore the Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_1_a_simple_p2d_model_live.html#Explore-the-Grid">Explore the Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_1_a_simple_p2d_model_live.html#Explore-the-States">Explore the States</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_1_a_simple_p2d_model_live.html#Plot-a-Result">Plot a Result</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pynbnotebooks/tutorial_2_changing_control_protocol_live.html">Tutorial 2 - Change the Control Protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_2_changing_control_protocol_live.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_2_changing_control_protocol_live.html#Explore-the-Control-Protocol">Explore the Control Protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_2_changing_control_protocol_live.html#Setup-and-Run-a-Parameter-Sweep">Setup and Run a Parameter Sweep</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_2_changing_control_protocol_live.html#Summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pynbnotebooks/tutorial_3_modify_structural_parameters_live.html">Tutorial 3 - Modify Structural Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_3_modify_structural_parameters_live.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_3_modify_structural_parameters_live.html#Explore-the-Structural-Parameters">Explore the Structural Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_3_modify_structural_parameters_live.html#Setup-and-Run-a-Parameter-Sweep">Setup and Run a Parameter Sweep</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_3_modify_structural_parameters_live.html#Summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pynbnotebooks/tutorial_4_modify_material_parameters_live.html">Tutorial 4 - Modify Material Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_4_modify_material_parameters_live.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_4_modify_material_parameters_live.html#Explore-the-Material-Parameters">Explore the Material Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_4_modify_material_parameters_live.html#Make-a-Simple-Change">Make a Simple Change</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_4_modify_material_parameters_live.html#Swap-Active-Materials">Swap Active Materials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_4_modify_material_parameters_live.html#Summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pynbnotebooks/tutorial_5_simulate_CCCV_cycling_live.html">Tutorial 5 - Simulate CC-CV Cycling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_5_simulate_CCCV_cycling_live.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_5_simulate_CCCV_cycling_live.html#Explore-the-Control-Definition">Explore the Control Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_5_simulate_CCCV_cycling_live.html#Summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pynbnotebooks/tutorial_6_simulate_thermal_performance_live.html">Tutorial 6 - Simulate Thermal Performance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_6_simulate_thermal_performance_live.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_6_simulate_thermal_performance_live.html#Setup-material-properties">Setup material properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_6_simulate_thermal_performance_live.html#Setup-the-geometry">Setup the geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_6_simulate_thermal_performance_live.html#Run-the-simulation">Run the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_6_simulate_thermal_performance_live.html#Visualisation-of-the-results">Visualisation of the results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_6_simulate_thermal_performance_live.html#Temperature-distribution-at-final-time">Temperature distribution at final time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_6_simulate_thermal_performance_live.html#The-external-heat-transfer-coefficient">The external heat transfer coefficient</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pynbnotebooks/tutorial_7_a_simple_p4d_model_live.html">Tutorial 7 - A Simple P4D Simulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_7_a_simple_p4d_model_live.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_7_a_simple_p4d_model_live.html#Visualize-the-Results">Visualize the Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_7_a_simple_p4d_model_live.html#Compare-with-a-P2D-Simulation">Compare with a P2D Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_7_a_simple_p4d_model_live.html#Summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pynbnotebooks/tutorial_8_simulate_a_multilayer_pouch_cell_live.html">Tutorial 8 - Simulate a Multilayer Pouch Cell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_8_simulate_a_multilayer_pouch_cell_live.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_8_simulate_a_multilayer_pouch_cell_live.html#Setup-the-model-for-inspection">Setup the model for inspection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_8_simulate_a_multilayer_pouch_cell_live.html#Run-the-simulation">Run the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_8_simulate_a_multilayer_pouch_cell_live.html#Visualize-the-Results">Visualize the Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pynbnotebooks/tutorial_9_simulate_a_cylindrical_cell_live.html">Tutorial 9 - Simulate a cylindrical cell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_9_simulate_a_cylindrical_cell_live.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_9_simulate_a_cylindrical_cell_live.html#Setup-the-model-for-inspection">Setup the model for inspection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_9_simulate_a_cylindrical_cell_live.html#Run-the-simulation">Run the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/tutorial_9_simulate_a_cylindrical_cell_live.html#Visualize-the-Results">Visualize the Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intermediate.html">Intermediate Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mergejsonstruct.html">Merging parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mergejsonstruct.html#setup-a-p4d-model-using-mergejsonstructs">Setup a P4D Model using <code class="code docutils literal notranslate"><span class="pre">mergeJsonStructs</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mergejsonstruct.html#define-parameters">Define Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mergejsonstruct.html#run-simulation">Run Simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mergejsonstruct.html#visualize-results">Visualize Results</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mergejsonstruct.html#file-links-and-insertions-with-parsebattmojson">File links and insertions with <code class="code docutils literal notranslate"><span class="pre">parseBattmoJson</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../functioninterface.html">Functional parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../functioninterface.html#function-name">Function name</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functioninterface.html#function-formula">Function formula</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functioninterface.html#tabulated-function">Tabulated function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../functioninterface.html#example">Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../functionInterfaceExample.html">Example of the function interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../modelinitialisation.html">The Battery Simulation Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../modelinitialisation.html#initialisation-of-a-battery-simulation-model">Initialisation of a battery simulation model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modelinitialisation.html#inspection-of-the-model">Inspection of the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modelinitialisation.html#computing-and-inspecting-some-standard-static-properties-of-the-model">Computing and inspecting some standard static properties of the model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../controlinput.html">Control models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../controlinput.html#json-input-control-interface">Json input control interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controlinput.html#control-model-description">Control model description</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../soliddiffusion.html">Solid Diffusion Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parsets.html">Parameter sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../units.html">Units</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../units.html#converting-units-in-battmo">Converting units in BattMo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../units.html#units-and-json-input">Units and JSON input</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../runThermalExample.html">Thermal simulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../runThermalExample.html#Setup-of-the-material-properties">Setup of the material properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runThermalExample.html#Setup-of-the-geometry">Setup of the geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runThermalExample.html#Setup-of-the-Control">Setup of the Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runThermalExample.html#Plot-of-the-external-heat-transfer-coefficient">Plot of the external heat transfer coefficient</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runThermalExample.html#Run-the-simulation">Run the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runThermalExample.html#Plot-of-the-voltage">Plot of the voltage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runThermalExample.html#Plot-of-the-minimum-and-maximum-values-of-the-temperature">Plot of the minimum and maximum values of the temperature</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runThermalExample.html#We-change-setup-for-cooling-coefficient">We change setup for cooling coefficient</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runThermalExample.html#Plot-of-temperatures">Plot of temperatures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runThermalExample.html#Plot-of-the-temperature-distribution">Plot of the temperature distribution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../runOnlyThermal.html">Comparison between coupled and uncoupled thermal simulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#setup-material-property-input">setup material property input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#Setup-geometry-input">Setup geometry input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#Setup-Control-input">Setup Control input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#Modify-input-structure">Modify input structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#Run-thermal-simulation">Run thermal simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#Plot-mesh">Plot mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#Run-iso-thermal-simulation">Run iso-thermal simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#Setup-thermal-only-simulation">Setup thermal-only simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#Setup-heat-source-term">Setup heat source term</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#Setup-thermal-only-model">Setup thermal-only model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#Setup-the-simulation-schedule">Setup the simulation schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#setup-initial-state">setup initial state</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#run-thermal-only-simulation">run thermal-only simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runOnlyThermal.html#Plotting">Plotting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../runSiliconGraphiteBattery.html">Simulation of a composite active material</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../runSiliconGraphiteBattery.html#Setup-the-properties-of-the-battery">Setup the properties of the battery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runSiliconGraphiteBattery.html#We-modify-some-parameters">We modify some parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runSiliconGraphiteBattery.html#We-run-the-simulations">We run the simulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runSiliconGraphiteBattery.html#Plotting">Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runSiliconGraphiteBattery.html#plot-of-the-particle-concentration-distribution-in-the-particle-at-the-end-time">plot of the particle concentration distribution in the particle at the end time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runSiliconGraphiteBattery.html#Charge-step">Charge step</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runSiliconGraphiteBattery.html#Visualisation">Visualisation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../optimisation.html">Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../optimisation.html#parameter-identification-example">Parameter identification example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../optimisation.html#optimization-example">Optimization example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../octave.html">Octave</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modeling.html">Modeling with BattMo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pynbnotebooks/part_1_battery_modeling_guide.html">Part1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/part_1_battery_modeling_guide.html#Part-I:-Table-of-Contents">Part I: Table of Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/part_1_battery_modeling_guide.html#1.-Lithium-Ion-Battery-Basics"><strong>1. Lithium-Ion Battery Basics</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_1_battery_modeling_guide.html#1.1-Cell-Components"><strong>1.1 Cell Components</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_1_battery_modeling_guide.html#1.2-Working-Principle"><strong>1.2 Working Principle</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_1_battery_modeling_guide.html#1.3-Battery-Properties">1.3 Battery Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_1_battery_modeling_guide.html#1.4-Operational-Protocols"><strong>1.4 Operational Protocols</strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/part_1_battery_modeling_guide.html#2.-Modelling-with-BattMo"><strong>2. Modelling with BattMo</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_1_battery_modeling_guide.html#2.1-P2D/P3D/P4D-Models"><strong>2.1 P2D/P3D/P4D Models</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_1_battery_modeling_guide.html#2.2-Influence-of-structural-and-material-parameters-on-the-capacity"><strong>2.2 Influence of structural and material parameters on the capacity</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_1_battery_modeling_guide.html#3.-Summary">3. Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_1_battery_modeling_guide.html#4.-References"><strong>4. References</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html">Part2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Part-II:-Table-of-Contents">Part II: Table of Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#1.-DFN-Model-Overview">1. DFN Model Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#2.-Overpotentials-and-Voltage-losses"><strong>2. Overpotentials and Voltage losses</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-1.-OCV-curve-and-voltage-loss-at-different-C-rates"><strong>Example 1. OCV curve and voltage loss at different C-rates</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-2.-Mass-fraction-of-active-material-and-binder-in-electrode"><strong>Example 2. Mass</strong> fraction of active material and binder in electrode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-3.-Temperature">Example 3. Temperature</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-4.-Saturation-concentration-of-the-material">Example 4. Saturation concentration of the material</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-5.-Charge-transfer-coefficient,-anodic-and-cathodic-at-the-surface-of-the-active-particles:-Butler-Volmer-equation"><strong>Example 5.</strong> Charge transfer coefficient, anodic and cathodic at the surface of the active particles: Butler-Volmer equation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-6.-Reaction-rate-constant-at-the-surface-of-the-active-particles:-Butler-Volmer-equation-(exchange-current-density)"><strong>Example 6.</strong> Reaction rate constant at the surface of the active particles: Butler-Volmer equation (exchange current density)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-7.-Reference-diffusion-coefficient-(Solid-diffusion)">Example 7. Reference diffusion coefficient (Solid diffusion)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-8.-Active-particle-radius-(Solid-diffusion)"><strong>Example 8.</strong> Active particle radius (Solid diffusion)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-9.-Electronic-conductivity-of-the-active-material-in-the-electrodes-(effective-electronic-conductivity)"><strong>Example 9.</strong> Electronic conductivity of the active material in the electrodes (effective electronic conductivity)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-10.-Bruggeman-coefficient-in-the-electrodes-(effective-electronic-conductivity)"><strong>Example 10.</strong> Bruggeman coefficient in the electrodes (effective electronic conductivity)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-11.-Bruggeman-coefficient-in-the-electrolyte-(effective-ionic-conductivity)">Example 11. Bruggeman coefficient in the electrolyte (effective ionic conductivity)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-12.-Initial-electrolyte-concentration-(electrolyte-diffusion)"><strong>Example 12. Initial e</strong>lectrolyte concentration (electrolyte diffusion)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pynbnotebooks/part_2_battery_modeling_guide.html#Example-13.-Transference-number-(electrolyte-diffusion)"><strong>Example 13.</strong> Transference number (electrolyte diffusion)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">BattMo Model Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../json.html">JSON input specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../json.html#simulation-schema">Simulation Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#material-parameters">Material Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../json.html#electrolyte">Electrolyte</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#electrode">Electrode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#coating">Coating</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#active-material">Active Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#interface">Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#solid-diffusion">Solid Diffusion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#full-solid-diffusion">Full Solid Diffusion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#binder">Binder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#conducting-additive">Conducting Additive</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#current-collector">Current Collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#separator">Separator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#thermal-model">Thermal Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#geometry-setup">Geometry Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#simulation-control-parameters">Simulation Control Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#time-stepping-parameters">Time Stepping Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#solver-parameters">Solver Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#output-parameters">Output Parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../geometryinput.html">Battery Geometries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#batterygeneratorp2d">BatteryGeneratorP2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#batterygeneratorp3d">BatteryGeneratorP3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#batterygeneratorp4d">BatteryGeneratorP4D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#spiralbatterygenerator">SpiralBatteryGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#coincellbatterygenerator">CoinCellBatteryGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#batterygeneratormultilayerpouch">BatteryGeneratorMultilayerPouch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../juliabridge.html">BattMo Julia bridge</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../juliabridge.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../juliabridge.html#start-server">Start Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../juliabridge.html#send-simulation-parameters">Send simulation parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../juliabridge.html#run-the-simulation">Run the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../juliabridge.html#post-process-the-output">Post process the output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="runElectrolyser.html">Electrolyser simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-input">Setup input</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-model">Setup model</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-the-initial-condition">Setup the initial condition</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-the-schedule-with-the-time-discretization">Setup the schedule with the time discretization</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-the-non-linear-solver">Setup the non-linear solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#run-the-simulation">Run the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#visualize-the-results">Visualize the results</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#ph-distribution-plot">pH distribution plot</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../protonicmembrane.html">Proton Ceramic Membrane</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="runProtonicMembrane.html">Proton Ceramic Membrane</a><ul>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#model-overview">Model overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="runProtonicMembrane.html#governing-equations">Governing equations</a></li>
<li class="toctree-l4"><a class="reference internal" href="runProtonicMembrane.html#boundary-conditions">Boundary conditions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#load-and-parse-input-from-given-json-files">Load and parse input from given json files</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#input-structure-setup">Input structure setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#model-setup">Model setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#initial-state-setup">Initial state setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#schedule">Schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#simulation">Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#plotting">Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#evolution-of-the-faradic-efficiency">Evolution of the Faradic efficiency</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="runGasSupply.html">Gas Supply</a><ul>
<li class="toctree-l3"><a class="reference internal" href="runGasSupply.html#model-overview">Model overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="runGasSupply.html#governing-equations">Governing equations</a></li>
<li class="toctree-l4"><a class="reference internal" href="runGasSupply.html#boundary-conditions">Boundary conditions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="runGasSupply.html#json-input-data">json input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="runGasSupply.html#input-parameter-setup">Input parameter setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="runGasSupply.html#model-setup">Model setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="runGasSupply.html#model-plot">Model Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="runGasSupply.html#setup-initial-state">Setup initial state</a></li>
<li class="toctree-l3"><a class="reference internal" href="runGasSupply.html#schedule-setup">Schedule setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="runGasSupply.html#simulation">Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="runGasSupply.html#result-plots">Result plots</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Full Cell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#model-coupling">Model coupling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#json-input-data">json input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-parameter-setup">Input parameter setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-setup">Model setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#grid-plots">Grid plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-initial-state">Setup initial state</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-schedule">Setup schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-nonlinear-solver">Setup nonlinear solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#start-simulation">Start simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plotting-setup">plotting setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#electrolyte-results">Electrolyte results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gas-layer-results">Gas Layer results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interface-results">Interface results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../app.html">BattMoApp</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../app_features.html">Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#utilize-default-materials">Utilize Default Materials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#customize-with-your-own-materials">Customize with Your Own Materials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#visualize-your-battery-geometry">Visualize Your Battery Geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#download-input-data">Download Input Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#upload-input-data">Upload Input Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#visualize-and-download-results">Visualize and Download Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#upload-your-previous-results">Upload your previous results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app_troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app_unnatural_artifacts.html">Unnatural artifacts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../app_unnatural_artifacts.html#discritization-issues">Discritization issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../app_unsuccessful_simulation.html">Unsuccessful simulation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../app_unsuccessful_simulation.html#using-lifepo4-datasets">Using LiFePO4 datasets</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../computationalGraph/graphdoc.html">Computational Graph</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../computationalGraph/graphdoc.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computationalGraph/graphdoc.html#model-assembly">Model assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computationalGraph/graphdoc.html#model-explorability">Model explorability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computationalGraph/graphdoc.html#model-hierarchy-and-composition">Model hierarchy and composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computationalGraph/graphdoc.html#basic-example">Basic Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computationalGraph/graphdoc.html#graph-setup-and-implementation">Graph Setup and Implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../seealso.html">See Also</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../seealso.html#mrst">MRST</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../seealso.html#visualization">Visualization Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../seealso.html#id2">Grid Factory Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../seealso.html#fair-data">FAIR Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BattMo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../protonicmembrane.html">Proton Ceramic Membrane</a></li>
      <li class="breadcrumb-item active">PEM electrolyser with Gas Supply</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/publishedExamples/runProtonicCell.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pem-electrolyser-with-gas-supply">
<span id="runprotoniccell"></span><h1>PEM electrolyser with Gas Supply<a class="headerlink" href="#pem-electrolyser-with-gas-supply" title="Link to this heading"></a></h1>
<p><em>Generated from runProtonicCell.m</em></p>
<section id="model-coupling">
<h2>Model coupling<a class="headerlink" href="#model-coupling" title="Link to this heading"></a></h2>
<p>We couple the <a class="reference internal" href="runGasSupply.html#rungassupply"><span class="std std-ref">gas supply layer</span></a> with the anode of the <a class="reference internal" href="runProtonicMembrane.html#runprotonicmembrane"><span class="std std-ref">proton membrane</span></a>. The coupling occurs at the interface of the two regions. Along the anode, we assume a constant
voltage, that is, we neglect the potential loss in this part.</p>
<p>The chemical reaction at the interface is</p>
<div class="math notranslate nohighlight">
\[\ce{1/2 H2O &lt;-&gt; H^+ + e^- + 1/4 O2}\]</div>
<p>It relates the mass fluxes in the gas supply layer and inside the anode in the following way</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcl}
 j_\ce{H2O}\cdot n &amp;=&amp; 2j_{\ce{H^+}}\cdot n\\
 j_{\ce{O2}}\cdot n &amp;=&amp; -4j_{\ce{H^+}}\cdot n
\end{array}\end{split}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(n\)</span> denotes the normal at the interface (same orientation in the whole expression), so that, for example,
<span class="math notranslate nohighlight">\(j_\ce{H2O}\cdot n\)</span> denotes the mass of <span class="math notranslate nohighlight">\(\ce{H2O}\)</span> leaving the gas layer in <span class="math notranslate nohighlight">\(kg/m^2/s\)</span> (for a 3D
model). For the gas layer, the fluxes are given by the sum of the convection and diffusion fluxes, so that, for
<span class="math notranslate nohighlight">\(\ce{H2O}\)</span>, we have</p>
<div class="math notranslate nohighlight">
\[j_\ce{H2O}\cdot n = -D \nabla(\rho x_{\ce{H2O}})\cdot n - \frac{K}{\mu}\rho x_i \nabla p\cdot n\]</div>
<p>and a similar expression for the flux of <span class="math notranslate nohighlight">\(\ce{O2}\)</span> at the interface.</p>
</section>
<section id="json-input-data">
<h2>json input data<a class="headerlink" href="#json-input-data" title="Link to this heading"></a></h2>
<p>We load the input data that is given by json structures. The physical properties of the supply gas layer is given in the json file <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/jsonfiles/gas-supply-whole-cell.json">gas-supply-whole-cell.json</a></p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">clear</span><span class="w"> </span><span class="n">jsonstruct_material</span>
<span class="n">filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;ProtonicMembrane/jsonfiles/gas-supply-whole-cell.json&#39;</span><span class="p">;</span>
<span class="n">jsonstruct_material</span><span class="p">.</span><span class="n">GasSupply</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parseBattmoJson</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
<span class="n">filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;ProtonicMembrane/jsonfiles/protonicMembrane.json&#39;</span><span class="p">;</span>
<span class="n">jsonstruct_material</span><span class="p">.</span><span class="n">Electrolyser</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parseBattmoJson</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>

<span class="n">jsonstruct_material</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">removeJsonStructFields</span><span class="p">(</span><span class="n">jsonstruct_material</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                             </span><span class="p">{</span><span class="s">&#39;Electrolyser&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Electrolyte&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Nx&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                             </span><span class="p">{</span><span class="s">&#39;Electrolyser&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Electrolyte&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;xlength&#39;</span><span class="p">});</span>
</pre></div>
</div>
<p>The geometrical property of the cell is given in <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/jsonfiles/2d-cell-geometry.json">2d-cell-geometry.json</a></p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;ProtonicMembrane/jsonfiles/2d-cell-geometry.json&#39;</span><span class="p">;</span>
<span class="n">jsonstruct_geometry</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parseBattmoJson</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</pre></div>
</div>
<p>The initial state is given in <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/jsonfiles/gas-supply-initialization.json">gas-supply-initialization.json</a></p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;ProtonicMembrane/jsonfiles/gas-supply-initialization.json&#39;</span><span class="p">;</span>
<span class="n">jsonstruct_initialization</span><span class="p">.</span><span class="n">GasSupply</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parseBattmoJson</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</pre></div>
</div>
<p>The time stepping parameters are given in <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/jsonfiles/cell-timestepping.json">cell-timestepping.json</a></p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;ProtonicMembrane/jsonfiles/cell-timestepping.json&#39;</span><span class="p">;</span>
<span class="n">jsonstruct_timestepping</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parseBattmoJson</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</pre></div>
</div>
<p>We merge all the json struct we have created to obtain a complete json structure that can be use to setup the model</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">jsonstruct</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mergeJsonStructs</span><span class="p">({</span><span class="n">jsonstruct_material</span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                               </span><span class="n">jsonstruct_geometry</span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                               </span><span class="n">jsonstruct_initialization</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                               </span><span class="n">jsonstruct_timestepping</span><span class="p">});</span>
</pre></div>
</div>
<p>We change the value of the current density to the value we want to use in this simulation</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">jsonstruct</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">Control</span><span class="p">.</span><span class="n">currentDensity</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.1</span><span class="o">*</span><span class="n">ampere</span><span class="o">/</span><span class="p">((</span><span class="n">centi</span><span class="o">*</span><span class="n">meter</span><span class="p">)</span>^<span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="input-parameter-setup">
<h2>Input parameter setup<a class="headerlink" href="#input-parameter-setup" title="Link to this heading"></a></h2>
<p>We setup the input parameter structure which will we be used to instantiate the model</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">inputparams</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ProtonicMembraneCellInputParams</span><span class="p">(</span><span class="n">jsonstruct</span><span class="p">);</span>
</pre></div>
</div>
<p>We setup the grid, by calling the function <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/utils/setupProtonicMembraneGasLayerGrid.m">setupProtonicMembraneGasLayerGrid</a></p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">inputparams</span><span class="p">,</span><span class="w"> </span><span class="n">gen</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">setupProtonicMembraneCellGrid</span><span class="p">(</span><span class="n">inputparams</span><span class="p">,</span><span class="w"> </span><span class="n">jsonstruct</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="model-setup">
<h2>Model setup<a class="headerlink" href="#model-setup" title="Link to this heading"></a></h2>
<p>We setup the model for the full cell (electrolyser and a gas supply layer).</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ProtonicMembraneCell</span><span class="p">(</span><span class="n">inputparams</span><span class="p">);</span>
</pre></div>
</div>
<p>The model is equipped for simulation using the following command (this step may become unnecessary in future versions)</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">setupForSimulation</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="grid-plots">
<h2>Grid plots<a class="headerlink" href="#grid-plots" title="Link to this heading"></a></h2>
<p>We plot the different regions with their grids.
To resolve the non-linearity in the electrolyte, we need a very fine mesh. Plotting the full mesh including the edges for this domain will hide its structure. Therefore we set the option <code class="code docutils literal notranslate"><span class="pre">edgecolor</span></code> to <code class="code docutils literal notranslate"><span class="pre">none</span></code>.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">figure</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">337</span><span class="p">,</span><span class="w"> </span><span class="mi">757</span><span class="p">,</span><span class="w"> </span><span class="mi">3068</span><span class="p">,</span><span class="w"> </span><span class="mi">557</span><span class="p">])</span>
<span class="nb">hold</span><span class="w"> </span><span class="n">on</span>
<span class="n">plotGrid</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plotGrid</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;facecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;red&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plotGrid</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">GasSupply</span><span class="p">.</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;facecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.9</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="s">&#39;edgealpha&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_01.png" src="../_images/runProtonicCell_01.png" />
</figure>
<p>We plot the boundary and interface faces</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">spring</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="n">opts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;linewidth&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="p">:)};</span>
</pre></div>
</div>
<p>we plot the inlet faces</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">figure</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">337</span><span class="p">,</span><span class="w"> </span><span class="mi">757</span><span class="p">,</span><span class="w"> </span><span class="mi">3068</span><span class="p">,</span><span class="w"> </span><span class="mi">557</span><span class="p">])</span>
<span class="n">plotGrid</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;facecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;red&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plotGrid</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">GasSupply</span><span class="p">.</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;facecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;edgealpha&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plotFaces</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">GasSupply</span><span class="p">.</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">GasSupply</span><span class="p">.</span><span class="n">couplingTerms</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">couplingfaces</span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p">{:});</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_02.png" src="../_images/runProtonicCell_02.png" />
</figure>
<p>we add the outlet faces</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">plotFaces</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">GasSupply</span><span class="p">.</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">GasSupply</span><span class="p">.</span><span class="n">couplingTerms</span><span class="p">{</span><span class="mi">2</span><span class="p">}.</span><span class="n">couplingfaces</span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p">{:});</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_03.png" src="../_images/runProtonicCell_03.png" />
</figure>
<p>we add the interface faces</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">plotFaces</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">GasSupply</span><span class="p">.</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">couplingTerm</span><span class="p">.</span><span class="n">couplingfaces</span><span class="p">(:,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p">{:});</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_04.png" src="../_images/runProtonicCell_04.png" />
</figure>
</section>
<section id="setup-initial-state">
<h2>Setup initial state<a class="headerlink" href="#setup-initial-state" title="Link to this heading"></a></h2>
<p>The initial state for the cell is used using the initial state of the gas layer that have been loaded (see <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/jsonfiles/gas-supply-initialization.json">here</a>)</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">initstate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">setupInitialState</span><span class="p">(</span><span class="n">jsonstruct</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="setup-schedule">
<h2>Setup schedule<a class="headerlink" href="#setup-schedule" title="Link to this heading"></a></h2>
<p>We setup the time stepping. We are computing the steady state solution, using the the time evolution equation. Note that we also use a numerical method which gradually introduces the high nonlinearities inherent to the problem (in particular the exponential dependence of the electronic conductivity in the membrane). Therefore, the intermediate solutions (i.e. those computed before the final step) should be considered with care.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">schedule</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">setupSchedule</span><span class="p">(</span><span class="n">jsonstruct</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="setup-nonlinear-solver">
<h2>Setup nonlinear solver<a class="headerlink" href="#setup-nonlinear-solver" title="Link to this heading"></a></h2>
<p>We use an adaptive time stepping. In this case, the solver will try to keep the number of timesteps equal to 5, based on the timestepping history.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">IterationCountTimeStepSelector</span><span class="p">(</span><span class="s">&#39;targetIterationCount&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>

<span class="n">nls</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">NonLinearSolver</span><span class="p">();</span>
<span class="n">nls</span><span class="p">.</span><span class="n">timeStepSelector</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ts</span><span class="p">;</span>
<span class="n">nls</span><span class="p">.</span><span class="n">maxIterations</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="mi">15</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="start-simulation">
<h2>Start simulation<a class="headerlink" href="#start-simulation" title="Link to this heading"></a></h2>
<p>We start the simulation</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="w"> </span><span class="n">states</span><span class="p">,</span><span class="w"> </span><span class="n">report</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">simulateScheduleAD</span><span class="p">(</span><span class="n">initstate</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">schedule</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;OutputMinisteps&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;NonLinearSolver&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nls</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="plotting-setup">
<h2>plotting setup<a class="headerlink" href="#plotting-setup" title="Link to this heading"></a></h2>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">close</span><span class="w"> </span><span class="nb">all</span>

<span class="nb">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;defaultlinelinewidth&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="nb">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;defaultaxesfontsize&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">);</span>
<span class="nb">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;defaultfigureposition&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">1290</span><span class="p">,</span><span class="w"> </span><span class="mi">755</span><span class="p">,</span><span class="w"> </span><span class="mi">1275</span><span class="p">,</span><span class="w"> </span><span class="mi">559</span><span class="p">])</span>

<span class="n">elyser</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Electrolyser&#39;</span><span class="p">;</span>
<span class="n">elyte</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Electrolyte&#39;</span><span class="p">;</span>
<span class="n">gs</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;GasSupply&#39;</span><span class="p">;</span>

<span class="n">state</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">states</span><span class="p">{</span><span class="k">end</span><span class="p">};</span>
<span class="n">state</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">addVariables</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="electrolyte-results">
<h2>Electrolyte results<a class="headerlink" href="#electrolyte-results" title="Link to this heading"></a></h2>
<p>We plot the electrostatic potential <span class="math notranslate nohighlight">\(\phi\)</span> (we need to remove the plotting of the grid edges, otherwise due to the grid refinement, they will hide completely the color of the field)</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">figure</span>
<span class="n">plotCellData</span><span class="p">(</span><span class="n">model</span><span class="p">.(</span><span class="n">elyser</span><span class="p">).(</span><span class="n">elyte</span><span class="p">).</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">.(</span><span class="n">elyser</span><span class="p">).(</span><span class="n">elyte</span><span class="p">).</span><span class="n">phi</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Electrostatic Potential \phi / V&#39;</span><span class="p">)</span>
<span class="nb">colorbar</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_05.png" src="../_images/runProtonicCell_05.png" />
</figure>
<p>We want also to plot the result as a surface plot. Then, we need to manipulate the output and make it suitable to the <code class="code docutils literal notranslate"><span class="pre">surf</span></code> function of matlab (we do not explain those details here)</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">N</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">gen</span><span class="p">.</span><span class="n">nxElectrolyser</span><span class="p">;</span>
<span class="n">xc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.(</span><span class="n">elyser</span><span class="p">).(</span><span class="n">elyte</span><span class="p">).</span><span class="n">grid</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">centroids</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="n">X</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">model</span><span class="p">.(</span><span class="n">elyser</span><span class="p">).(</span><span class="n">elyte</span><span class="p">).</span><span class="n">grid</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">centroids</span><span class="p">(:,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="p">[])</span><span class="o">/</span><span class="p">(</span><span class="n">milli</span><span class="o">*</span><span class="n">meter</span><span class="p">);</span>
<span class="n">Y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">model</span><span class="p">.(</span><span class="n">elyser</span><span class="p">).(</span><span class="n">elyte</span><span class="p">).</span><span class="n">grid</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">centroids</span><span class="p">(:,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="p">[])</span><span class="o">/</span><span class="p">(</span><span class="n">milli</span><span class="o">*</span><span class="n">meter</span><span class="p">);</span>

<span class="n">figure</span>
<span class="s">val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">state</span><span class="p">.(</span><span class="n">elyser</span><span class="p">).(</span><span class="n">elyte</span><span class="p">).</span><span class="n">phi</span><span class="p">;</span>
<span class="n">Z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="p">[]);</span>
<span class="nb">surf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;\phi / V&#39;</span><span class="p">)</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;x / mm&#39;</span><span class="p">)</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;y / mm&#39;</span><span class="p">)</span>
<span class="nb">view</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">)</span>
<span class="nb">colorbar</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_06.png" src="../_images/runProtonicCell_06.png" />
</figure>
<p>We produce a surface plot of the electromotive potential <span class="math notranslate nohighlight">\(\pi\)</span>.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">figure</span>
<span class="n">val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">state</span><span class="p">.(</span><span class="n">elyser</span><span class="p">).(</span><span class="n">elyte</span><span class="p">).</span><span class="n">pi</span><span class="p">;</span>
<span class="n">Z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="p">[]);</span>
<span class="nb">surf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;pi / V&#39;</span><span class="p">)</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;x / mm&#39;</span><span class="p">)</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;y / mm&#39;</span><span class="p">)</span>
<span class="nb">view</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">)</span>
<span class="nb">colorbar</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_07.png" src="../_images/runProtonicCell_07.png" />
</figure>
</section>
<section id="gas-layer-results">
<h2>Gas Layer results<a class="headerlink" href="#gas-layer-results" title="Link to this heading"></a></h2>
<p>We plot the H2O mass fraction in the gas diffusion layer. We observe how the water is being first consumed close to the inlet (inlet is at bottom, outlet at top).</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">figure</span>
<span class="n">plotCellData</span><span class="p">(</span><span class="n">model</span><span class="p">.(</span><span class="n">gs</span><span class="p">).</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">.(</span><span class="n">gs</span><span class="p">).</span><span class="n">massfractions</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;H2O mass fraction / -&#39;</span><span class="p">)</span>
<span class="nb">colorbar</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_08.png" src="../_images/runProtonicCell_08.png" />
</figure>
<p>We plot the same result as a surface plot</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">N</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">gen</span><span class="p">.</span><span class="n">nxGasSupply</span><span class="p">;</span>

<span class="n">X</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">model</span><span class="p">.(</span><span class="n">gs</span><span class="p">).</span><span class="n">grid</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">centroids</span><span class="p">(:,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="p">[])</span><span class="o">/</span><span class="p">(</span><span class="n">milli</span><span class="o">*</span><span class="n">meter</span><span class="p">);</span>
<span class="n">Y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">model</span><span class="p">.(</span><span class="n">gs</span><span class="p">).</span><span class="n">grid</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">centroids</span><span class="p">(:,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="p">[])</span><span class="o">/</span><span class="p">(</span><span class="n">milli</span><span class="o">*</span><span class="n">meter</span><span class="p">);</span>


<span class="n">val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">state</span><span class="p">.(</span><span class="n">gs</span><span class="p">).</span><span class="n">massfractions</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="n">Z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="p">[]);</span>

<span class="nb">surf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">);</span>
<span class="n">colorbar</span>
<span class="s">title(&#39;Mass Fraction H2O&#39;)</span><span class="p">;</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;x / mm&#39;</span><span class="p">)</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;y / mm&#39;</span><span class="p">)</span>
<span class="nb">view</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">51</span><span class="p">]);</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_09.png" src="../_images/runProtonicCell_09.png" />
</figure>
<p>We plot the O2 mass fraction</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">figure</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">1290</span><span class="p">,</span><span class="w"> </span><span class="mi">755</span><span class="p">,</span><span class="w"> </span><span class="mi">1275</span><span class="p">,</span><span class="w"> </span><span class="mi">559</span><span class="p">])</span>

<span class="n">val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">state</span><span class="p">.(</span><span class="n">gs</span><span class="p">).</span><span class="n">massfractions</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span>
<span class="n">Z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="p">[]);</span>

<span class="nb">surf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">);</span>
<span class="n">colorbar</span>
<span class="s">title(&#39;Mass Fraction O2&#39;)</span><span class="p">;</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;x / mm&#39;</span><span class="p">)</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;y / mm&#39;</span><span class="p">)</span>
<span class="nb">view</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">51</span><span class="p">]);</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_10.png" src="../_images/runProtonicCell_10.png" />
</figure>
</section>
<section id="interface-results">
<h2>Interface results<a class="headerlink" href="#interface-results" title="Link to this heading"></a></h2>
<p>Current density in the anode. We recover the current on each face along the anode.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">Anode</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
</pre></div>
</div>
<p>From the current values at each face, we compute the current density by dividing with the face areas.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">ind</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">couplingTerms</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">couplingfaces</span><span class="p">(:,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="n">yc</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">Electrolyte</span><span class="p">.</span><span class="n">grid</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="n">areas</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">Electrolyte</span><span class="p">.</span><span class="n">grid</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">areas</span><span class="p">(</span><span class="n">ind</span><span class="p">);</span>

<span class="n">u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ampere</span><span class="o">/</span><span class="p">((</span><span class="n">centi</span><span class="o">*</span><span class="n">meter</span><span class="p">)</span>^<span class="mi">2</span><span class="p">);</span>
<span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">i</span><span class="o">./</span><span class="n">areas</span><span class="p">)</span><span class="o">/</span><span class="n">u</span><span class="p">;</span><span class="w"> </span><span class="c">% We convert to A/cm^2</span>

<span class="nb">figure</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">yc</span><span class="o">/</span><span class="p">(</span><span class="n">milli</span><span class="o">*</span><span class="n">meter</span><span class="p">),</span><span class="w"> </span><span class="nb">i</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Current in Anode / A/cm^2&#39;</span><span class="p">)</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;height / mm&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_11.png" src="../_images/runProtonicCell_11.png" />
</figure>
<p>We do the same but now for the proton current.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">iHp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">Anode</span><span class="p">.</span><span class="n">iHp</span><span class="p">;</span>

<span class="n">ind</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">couplingTerms</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">couplingfaces</span><span class="p">(:,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="n">yc</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">Electrolyte</span><span class="p">.</span><span class="n">grid</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="n">areas</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">Electrolyte</span><span class="p">.</span><span class="n">grid</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">areas</span><span class="p">(</span><span class="n">ind</span><span class="p">);</span>

<span class="n">u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ampere</span><span class="o">/</span><span class="p">((</span><span class="n">centi</span><span class="o">*</span><span class="n">meter</span><span class="p">)</span>^<span class="mi">2</span><span class="p">);</span>
<span class="n">iHp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">iHp</span><span class="o">./</span><span class="n">areas</span><span class="p">)</span><span class="o">/</span><span class="n">u</span><span class="p">;</span>

<span class="n">figure</span>
<span class="s">plot(yc/(milli*meter),</span><span class="w"> </span><span class="s">iHp)</span><span class="p">;</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;iHp in Anode / A/cm^2&#39;</span><span class="p">)</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;height / mm&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_12.png" src="../_images/runProtonicCell_12.png" />
</figure>
<p>By dividing the proton current density with the total current density, we obtain the Faradic efficiency.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% drivingForces.src = schedule.control.src;</span>
<span class="c">% state = model.evalVarName(state, &#39;Electrolyser.Anode.iHp&#39;, {{&#39;drivingForces&#39;, drivingForces}});</span>

<span class="nb">i</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">Anode</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
<span class="n">iHp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">Anode</span><span class="p">.</span><span class="n">iHp</span><span class="p">;</span>

<span class="n">ind</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">couplingTerms</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">couplingfaces</span><span class="p">(:,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="n">yc</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">Electrolyser</span><span class="p">.</span><span class="n">Electrolyte</span><span class="p">.</span><span class="n">grid</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>

<span class="n">figure</span>
<span class="s">plot(yc/(milli*meter),</span><span class="w"> </span><span class="s">iHp./i)</span><span class="p">;</span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Faradic efficiency&#39;</span><span class="p">)</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;height / mm&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runProtonicCell_13.png" src="../_images/runProtonicCell_13.png" />
</figure>
<p>complete source code can be found <a class="reference internal" href="runProtonicCell_source.html#runprotoniccell-source"><span class="std std-ref">here</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="runGasSupply.html" class="btn btn-neutral float-left" title="Gas Supply Layer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../app.html" class="btn btn-neutral float-right" title="BattMoApp" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
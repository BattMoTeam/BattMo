<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gas Supply Layer &mdash; BattMo  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />

  
    <link rel="shortcut icon" href="../_static/battmologo.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/design-tabs.js"></script>
        <script>window.MathJax = {"loader": {"load": ["[tex]/mhchem"]}, "tex": {"packages": {"[+]": ["mhchem"]}}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PEM electrolyser with Gas Supply" href="runProtonicCell.html" />
    <link rel="prev" title="Protonic Membrane model" href="runProtonicMembrane.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            BattMo
              <img src="../_static/battmologo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basicusage.html">Basic Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#a-first-battmo-model">A First <strong>BattMo</strong> Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#define-parameters">Define Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#run-simulation">Run Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#show-the-dashboard">Show the Dashboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#explore-the-output">Explore the Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#explore-the-grid">Explore the Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#explore-the-states">Explore the States</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicusage.html#plot-a-result">Plot a Result</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#change-control-parameters">Change Control Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#change-structural-parameters">Change Structural Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#change-material-parameters">Change Material Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#notebooks">Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basicusage.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intermediate.html">Intermediate usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intermediate.html#setup-a-p4d-model-using-mergejsonstructs">Setup a P4D Model using <code class="code docutils literal notranslate"><span class="pre">mergeJsonStructs</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intermediate.html#define-parameters">Define Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intermediate.html#run-simulation">Run Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intermediate.html#visualize-results">Visualize Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../intermediate.html#file-links-and-insertions-with-parsebattmojson">File links and insertions with <code class="code docutils literal notranslate"><span class="pre">parseBattmoJson</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">BattMo Model Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../json.html">JSON input specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../json.html#simulation-schema">Simulation Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#material-parameters">Material Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../json.html#electrolyte">Electrolyte</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#electrode">Electrode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#coating">Coating</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#active-material">Active Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#interface">Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#solid-diffusion">Solid Diffusion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#full-solid-diffusion">Full Solid Diffusion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#binder">Binder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#conducting-additive">Conducting Additive</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#current-collector">Current Collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#separator">Separator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../json.html#thermal-model">Thermal Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#geometry-setup">Geometry Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#simulation-control-parameters">Simulation Control Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#time-stepping-parameters">Time Stepping Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#solver-parameters">Solver Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json.html#output-parameters">Output Parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../geometryinput.html">Battery Geometries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#batterygeneratorp2d">BatteryGeneratorP2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#batterygeneratorp3d">BatteryGeneratorP3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#batterygeneratorp4d">BatteryGeneratorP4D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#spiralbatterygenerator">SpiralBatteryGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#coincellbatterygenerator">CoinCellBatteryGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometryinput.html#batterygeneratormultilayerpouch">BatteryGeneratorMultilayerPouch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advancedtopics.html">Advanced Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modelinitialisation.html">The Battery Simulation Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../modelinitialisation.html#initialisation-of-a-battery-simulation-model">Initialisation of a battery simulation model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modelinitialisation.html#inspection-of-the-model">Inspection of the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modelinitialisation.html#computing-and-inspecting-some-standard-static-properties-of-the-model">Computing and inspecting some standard static properties of the model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../controlinput.html">Control models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../controlinput.html#json-input-control-interface">Json input control interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controlinput.html#control-model-description">Control model description</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../soliddiffusion.html">Solid Diffusion Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parsets.html">Parameter sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../units.html">Units</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../units.html#converting-units-in-battmo">Converting units in BattMo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../units.html#units-and-json-input">Units and JSON input</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../thermal.html">Thermal Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimisation.html">Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../optimisation.html#parameter-identification-example">Parameter identification example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../optimisation.html#optimization-example">Optimization example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../octave.html">Octave</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../juliabridge.html">BattMo Julia bridge</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../juliabridge.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../juliabridge.html#start-server">Start Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../juliabridge.html#send-simulation-parameters">Send simulation parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../juliabridge.html#run-the-simulation">Run the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../juliabridge.html#post-process-the-output">Post process the output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="runElectrolyser.html">Electrolyser simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-input">Setup input</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-model">Setup model</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-the-initial-condition">Setup the initial condition</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-the-schedule-with-the-time-discretization">Setup the schedule with the time discretization</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#setup-the-non-linear-solver">Setup the non-linear solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#run-the-simulation">Run the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#visualize-the-results">Visualize the results</a></li>
<li class="toctree-l2"><a class="reference internal" href="runElectrolyser.html#ph-distribution-plot">pH distribution plot</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../protonicmembrane.html">Protonic Membrane</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="runProtonicMembrane.html">Protonic Membrane</a><ul>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#model-overview">Model overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="runProtonicMembrane.html#governing-equations">Governing equations</a></li>
<li class="toctree-l4"><a class="reference internal" href="runProtonicMembrane.html#boundary-conditions">Boundary conditions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#load-and-parse-input-from-given-json-files">Load and parse input from given json files</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#input-structure-setup">Input structure setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#model-setup">Model setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#initial-state-setup">Initial state setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#schedule">Schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#simulation">Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#plotting">Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicMembrane.html#evolution-of-the-faradic-efficiency">Evolution of the Faradic efficiency</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Gas Supply</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#model-overview">Model overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#governing-equations">Governing equations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boundary-conditions">Boundary conditions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#json-input-data">json input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-parameter-setup">Input parameter setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-setup">Model setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-plot">Model Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-initial-state">Setup initial state</a></li>
<li class="toctree-l3"><a class="reference internal" href="#schedule-setup">Schedule setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation">Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#result-plots">Result plots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="runProtonicCell.html">Full Cell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#model-coupling">Model coupling</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#json-input-data">json input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#input-parameter-setup">Input parameter setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#model-setup">Model setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#grid-plots">Grid plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#setup-initial-state">Setup initial state</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#setup-schedule">Setup schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#setup-nonlinear-solver">Setup nonlinear solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#start-simulation">Start simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#plotting-setup">plotting setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#electrolyte-results">Electrolyte results</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#gas-layer-results">Gas Layer results</a></li>
<li class="toctree-l3"><a class="reference internal" href="runProtonicCell.html#interface-results">Interface results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../app.html">BattMoApp</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../app_features.html">Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#utilize-default-materials">Utilize Default Materials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#customize-with-your-own-materials">Customize with Your Own Materials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#visualize-your-battery-geometry">Visualize Your Battery Geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#download-input-data">Download Input Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#upload-input-data">Upload Input Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#visualize-and-download-results">Visualize and Download Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_features.html#upload-your-previous-results">Upload your previous results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app_troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app_unnatural_artifacts.html">Unnatural artifacts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../app_unnatural_artifacts.html#discritization-issues">Discritization issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../app_unsuccessful_simulation.html">Unsuccessful simulation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../app_unsuccessful_simulation.html#using-lifepo4-datasets">Using LiFePO4 datasets</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../computationalGraph/graphdoc.html">Computational Graph</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../computationalGraph/graphdoc.html#a-simple-introduction-example">A simple introduction example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computationalGraph/graphdoc.html#graph-composition">Graph composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computationalGraph/graphdoc.html#graph-setup-and-implementation">Graph Setup and Implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../seealso.html">See Also</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../seealso.html#mrst">MRST</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../seealso.html#visualization">Visualization Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../seealso.html#id2">Grid Factory Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../seealso.html#fair-data">FAIR Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BattMo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../protonicmembrane.html">Protonic Membrane</a></li>
      <li class="breadcrumb-item active">Gas Supply Layer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/publishedExamples/runGasSupply.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gas-supply-layer">
<span id="rungassupply"></span><h1>Gas Supply Layer<a class="headerlink" href="#gas-supply-layer" title="Permalink to this heading"></a></h1>
<p><em>Generated from runGasSupply.m</em></p>
<section id="model-overview">
<h2>Model overview<a class="headerlink" href="#model-overview" title="Permalink to this heading"></a></h2>
<p>We present here a simulation model for a single gas layer. The complete electroyser has two such layers, see
illustration below.</p>
<figure class="align-center" id="id1">
<a class="reference external image-reference" href="../_images/gas-layer-illustration.png"><img alt="../_images/gas-layer-illustration.png" src="../_images/gas-layer-illustration.png" /></a>
<figcaption>
<p><span class="caption-text">Illustration of the electrolyser with the two gas layer domains</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>We consider the gas layer alone, without coupling with the electrodes. We will choose here the gas layer used at the
anode. We inject a mixture of two gases (H2O and O2). We model the gas supply layer as a porous media. The flow is then driven by a pressure gradient and the effect of diffusion.</p>
<section id="governing-equations">
<h3>Governing equations<a class="headerlink" href="#governing-equations" title="Permalink to this heading"></a></h3>
<p>The governing equations are given by mass conservation. We have</p>
<div class="math notranslate nohighlight">
\[\frac{\partial\rho x_i}{\partial t} + \nabla\cdot\left(j_{\text{conv},i} + j_{\text{diff}, i}\right) = 0.\]</div>
<p>where <span class="math notranslate nohighlight">\(\rho\)</span> denotes the density, <span class="math notranslate nohighlight">\(x_i\)</span> the mass fraction of the component <span class="math notranslate nohighlight">\(i\)</span>, for
<span class="math notranslate nohighlight">\(i=\{1,2\}\)</span>. The convection and diffusion fluxes are denoted with <span class="math notranslate nohighlight">\(j_{\text{conv},i}\)</span> and
<span class="math notranslate nohighlight">\(j_{\text{diff}, i}\)</span>, respectively.</p>
<p>We use a simple equation of state for the gases, as we assume that they behave as ideal gas.</p>
<p>For the momentum equation, we use the Darcy approximation which covers the case of a flow in a porous media. The Darcy velocity is given by</p>
<div class="math notranslate nohighlight">
\[u = -\frac{K}{\mu}\nabla p,\]</div>
<p>where <span class="math notranslate nohighlight">\(K\)</span> denotes the permeability and <span class="math notranslate nohighlight">\(mu\)</span> the viscosity. We are working on a model which uses the Stokes equations, which can be used for a free flow.</p>
<p>The convection term for each species is given by</p>
<div class="math notranslate nohighlight">
\[u_{\text{conv}, i} =  \rho x_i u.\]</div>
<p>For the diffusion term, we use a Fick diffusion model and the diffusion flux for each component is given by</p>
<div class="math notranslate nohighlight">
\[\hat j_{\text{diff}, i} = -D_i \nabla c_i\]</div>
<p>where <span class="math notranslate nohighlight">\(c_i\)</span> is the concentration of the specie <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(\hat j_{\text{diff}, i}\)</span> is the flux in
<span class="math notranslate nohighlight">\(mol/m^2/s\)</span>. We convert this flux in a mass flux, using the assumption that the gas are ideal gas, to obtain</p>
<div class="math notranslate nohighlight">
\[j_{\text{diff}, i} = -D_i \nabla (\rho x_i)\]</div>
<p>Our governing equations can now be rewritten using the explicit expression for the fluxes,</p>
<div class="math notranslate nohighlight">
\[\frac{\partial\rho x_i}{\partial t} + \nabla\cdot\left(\rho x_i u - D_i\nabla (\rho x_i)\right) = 0\]</div>
<p>This system of equation is discretized using finite volume and solved in time using backward Euler, for stability. The
unknowns are the pressure and one of the mass fractions.</p>
</section>
<section id="boundary-conditions">
<h3>Boundary conditions<a class="headerlink" href="#boundary-conditions" title="Permalink to this heading"></a></h3>
<p>We have implemented boundary equations of three types, which can be used for both inlet and outlet:</p>
<ul class="simple">
<li><p><strong>total mass rate and composition</strong></p></li>
<li><p><strong>pressure and composition</strong></p></li>
<li><p><strong>pressure and zero mass fraction derivative condition</strong></p></li>
</ul>
<p>The boundary conditions are applied on a subset of external faces in the grid (see drawing below). The two first types
of boundary conditions are standard.</p>
<p>When we impose the <strong>rate and composition</strong>, the given rate corresponds to the sum of all the input mass rates of every face
which belongs to the boundary condition (It means that each boundary face individually can see different mass rates). A
given composition corresponds to given mass fractions. This condition is use for the inlet in the example below, see
json input <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/jsonfiles/gas-supply.json#L16">here</a>.</p>
<p>The <strong>pressure and composition</strong> boundary condition corresponds to a standard Dirichlet condition. We would typically use
such condition at the outlet. Even for a convection dominated flow, the composition at the boundary is then given. This
could then result in an artifact in the outlet region because, in an experimental setup, we do not control the
composition directly at the outlet, and we do not want to model and simulate the flow outside the gas layer
region. Therefore, we introduced the third boundary condition.</p>
<p>When we use a <em>zero mass fraction derivative</em> boundary condition, we impose that the <em>derivative</em> of the mass fraction
in the normal direction at the boundary is zero, <span class="math notranslate nohighlight">\(\frac{\partial x_i}{\partial n} = 0\)</span>. In this way, we model a
situation where the outlet is connected to a long pipe which is itself connected to the ambient room, where we have a
given composition. In the pipe, the flow is dominated by convection and we cannot observe the separation effect of
diffusion (due to the difference in the value of the diffusion coefficient for each specie) at the beginning of the pipe
. Hence, the vanishing condition of the derivative of the mass fractions. This condition is implemented in the example
below, see <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/jsonfiles/gas-supply.json#L19">here</a>.</p>
</section>
</section>
<section id="json-input-data">
<h2>json input data<a class="headerlink" href="#json-input-data" title="Permalink to this heading"></a></h2>
<p>We load the input data that is given by json structures. The physical properties of the supply gas layer is given in the json file <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/jsonfiles/gas-supply.json">gas-supply.json</a></p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">battmoDir</span><span class="p">(),</span><span class="w"> </span><span class="s">&#39;ProtonicMembrane&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;jsonfiles&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;gas-supply.json&#39;</span><span class="p">);</span>
<span class="n">jsonstruct_material</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parseBattmoJson</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</pre></div>
</div>
<p>The geometry input is loaded from <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/jsonfiles/2d-gas-layer-geometry.json">2d-gas-layer-geometry.json</a></p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">battmoDir</span><span class="p">(),</span><span class="w"> </span><span class="s">&#39;ProtonicMembrane&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;jsonfiles&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;2d-gas-layer-geometry.json&#39;</span><span class="p">);</span>
<span class="n">jsonstruct_geometry</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parseBattmoJson</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</pre></div>
</div>
<p>The input for the initial state is loaded from <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/jsonfiles/gas-supply-initialization.json">gas-supply-initialization.json</a></p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">battmoDir</span><span class="p">(),</span><span class="w"> </span><span class="s">&#39;ProtonicMembrane&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;jsonfiles&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;gas-supply-initialization.json&#39;</span><span class="p">);</span>
<span class="n">jsonstruct_initialization</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parseBattmoJson</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>

<span class="n">jsonstruct</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mergeJsonStructs</span><span class="p">({</span><span class="n">jsonstruct_material</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                               </span><span class="n">jsonstruct_geometry</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                               </span><span class="n">jsonstruct_initialization</span><span class="p">});</span>
</pre></div>
</div>
</section>
<section id="input-parameter-setup">
<h2>Input parameter setup<a class="headerlink" href="#input-parameter-setup" title="Permalink to this heading"></a></h2>
<p>We setup the input parameter structure which will we be used to instantiate the model</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">inputparams</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ProtonicMembraneGasSupplyInputParams</span><span class="p">(</span><span class="n">jsonstruct</span><span class="p">);</span>
</pre></div>
</div>
<p>We setup the grid, which is done by calling the function <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/utils/setupProtonicMembraneGasLayerGrid.m">setupProtonicMembraneGasLayerGrid</a></p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">inputparams</span><span class="p">,</span><span class="w"> </span><span class="n">gridGenerator</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">setupProtonicMembraneGasLayerGrid</span><span class="p">(</span><span class="n">inputparams</span><span class="p">,</span><span class="w"> </span><span class="n">jsonstruct</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="model-setup">
<h2>Model setup<a class="headerlink" href="#model-setup" title="Permalink to this heading"></a></h2>
<p>We instantiate the model for the gas supply layer</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ProtonicMembraneGasSupply</span><span class="p">(</span><span class="n">inputparams</span><span class="p">);</span>
</pre></div>
</div>
<p>The model is equipped for simulation using the following command (this step may become unnecessary in future versions)</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">setupForSimulation</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="model-plot">
<h2>Model Plot<a class="headerlink" href="#model-plot" title="Permalink to this heading"></a></h2>
<p>We plot the simulation grid</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">grid</span><span class="p">;</span>

<span class="n">plotGrid</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runGasSupply_01.png" src="../_images/runGasSupply_01.png" />
</figure>
<p>The boundary conditions have been given by the input json file, see <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/jsonfiles/gas-supply.json#L16">gas-supply.json</a>. In this case we have rate control at the inlet at the bottom, and pressure control at the outlet at the top.
The index of the faces for the inlet and outlet are stored in a <code class="code docutils literal notranslate"><span class="pre">couplingTerm</span></code> structure (see <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/Utilities/InputParams/couplingTerm.m">here</a> for the base class). Those have been assigned when the grid is setup (for this example we have used <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ProtonicMembrane/geometry/GasSupplyGridGenerator2D.m">GasSupplyGridGenerator2D</a>).
We plot the inlet faces.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">coupTerm</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">couplingTerms</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="n">plotFaces</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="w"> </span><span class="n">coupTerm</span><span class="p">.</span><span class="n">couplingfaces</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;blue&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;linewidth&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runGasSupply_02.png" src="../_images/runGasSupply_02.png" />
</figure>
<p>We plot the outlet faces.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">coupTerm</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">couplingTerms</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span>
<span class="n">plotFaces</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="w"> </span><span class="n">coupTerm</span><span class="p">.</span><span class="n">couplingfaces</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;red&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;linewidth&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runGasSupply_03.png" src="../_images/runGasSupply_03.png" />
</figure>
</section>
<section id="setup-initial-state">
<h2>Setup initial state<a class="headerlink" href="#setup-initial-state" title="Permalink to this heading"></a></h2>
<p>The model provides us with a default initialization</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">initstate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">setupInitialState</span><span class="p">(</span><span class="n">jsonstruct</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="schedule-setup">
<h2>Schedule setup<a class="headerlink" href="#schedule-setup" title="Permalink to this heading"></a></h2>
<p>The schedule structure constains two fields <code class="code docutils literal notranslate"><span class="pre">step</span></code>, <code class="code docutils literal notranslate"><span class="pre">control</span></code>, which gives respectively the time steps and the control to be applied.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="mf">1e-2</span><span class="o">*</span><span class="nb">second</span><span class="p">;</span>
<span class="n">N</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>

<span class="n">dt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">rampupTimesteps</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">/</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="nb">step</span><span class="p">.</span><span class="n">val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dt</span><span class="p">;</span>
<span class="nb">step</span><span class="p">.</span><span class="n">control</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="nb">step</span><span class="p">.</span><span class="n">val</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="n">control</span><span class="p">.</span><span class="n">src</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"> </span><span class="c">% The control is taking care of by a dedicated submobel. Hence, the empty field here.</span>

<span class="n">schedule</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;control&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">control</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;step&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">step</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="simulation">
<h2>Simulation<a class="headerlink" href="#simulation" title="Permalink to this heading"></a></h2>
<p>We start the simulation</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="w"> </span><span class="n">states</span><span class="p">,</span><span class="w"> </span><span class="n">report</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">simulateScheduleAD</span><span class="p">(</span><span class="n">initstate</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">schedule</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="result-plots">
<h2>Result plots<a class="headerlink" href="#result-plots" title="Permalink to this heading"></a></h2>
<p>To analyse the result, we can use the interactive <code class="code docutils literal notranslate"><span class="pre">plotToolbar</span></code> command (see <a class="reference external" href="https://github.com/SINTEF-AppliedCompSci/MRST/blob/battmo/visualization/mrst-gui/plotToolbar.m">here</a>)</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">figure</span>
<span class="n">plotToolbar</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">states</span><span class="p">);</span>
<span class="c">%</span>
<span class="c">%</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runGasSupply_04.png" src="../_images/runGasSupply_04.png" />
</figure>
<p>We plot the pressure at the final step.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;defaultlinelinewidth&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="nb">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;defaultaxesfontsize&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">);</span>

<span class="n">state</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">states</span><span class="p">{</span><span class="k">end</span><span class="p">};</span>

<span class="n">G</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">grid</span><span class="p">;</span>

<span class="n">figure</span>
<span class="s">plotCellData(G,</span><span class="w"> </span><span class="s">state.pressure/barsa)</span><span class="p">;</span>
<span class="n">colorbar</span>
<span class="s">title(&#39;Pressure / bar&#39;)</span><span class="p">;</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runGasSupply_05.png" src="../_images/runGasSupply_05.png" />
</figure>
<p>We plot the water mass fractions at three different time step</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">inds</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="mi">8</span><span class="p">];</span>
<span class="n">ninds</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">inds</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ninds</span>
<span class="w">    </span><span class="nb">figure</span>
<span class="w">    </span><span class="n">state</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">states</span><span class="p">{</span><span class="n">inds</span><span class="p">(</span><span class="nb">i</span><span class="p">)};</span>
<span class="w">    </span><span class="n">plotCellData</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">massfractions</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;edgecolor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="n">clim</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4</span><span class="p">]);</span>
<span class="w">    </span><span class="nb">title</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;H2O mass fraction\n(timestep:%d)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">inds</span><span class="p">(</span><span class="nb">i</span><span class="p">)));</span>
<span class="w">    </span><span class="n">colorbar</span>
<span class="s">end</span>
</pre></div>
</div>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runGasSupply_06.png" src="../_images/runGasSupply_06.png" />
</figure>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runGasSupply_07.png" src="../_images/runGasSupply_07.png" />
</figure>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runGasSupply_08.png" src="../_images/runGasSupply_08.png" />
</figure>
<figure class="align-default" style="width: 100%">
<img alt="../_images/runGasSupply_09.png" src="../_images/runGasSupply_09.png" />
</figure>
<p>complete source code can be found <a class="reference internal" href="runGasSupply_source.html#rungassupply-source"><span class="std std-ref">here</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="runProtonicMembrane.html" class="btn btn-neutral float-left" title="Protonic Membrane model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="runProtonicCell.html" class="btn btn-neutral float-right" title="PEM electrolyser with Gas Supply" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
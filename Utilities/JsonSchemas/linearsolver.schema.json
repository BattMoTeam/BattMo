{
  "$id": "file://batmo/schemas/linearsolver",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "linear solver",
  "type": "object",
  "properties" : {"method" : {"type" : "string",
                              "enum" : ["direct", "iterative", "gmres"]},
                  "required" : ["method"]
                 },
  
  "anyOf" : [

    {"properties" : {"method" : {"const" : "direct"},
                     "description" : "no iterative solver, we use matlab direct inversion"
                    }
    },

    {"properties" : {"method" : {"const" : "iterative",
                                 "description": " We use an iterative solver for the whole system without preconditioning"},
                     "solverspec" : {"$ref" : "#/$defs/solverspec"}
                    }
    },

    {"properties" : {"method" : {"const" : "gmres",
                                 "description" : "We use matlab gmres solver with preconditioning"},
                     
                     "options" : {"type" : "object",
                                  "description" : "preconditioners sent to the gmres matlab routine to solve the potential, concentration and temperature",

                                  "properties" : {"method" : {"type" : "string",
                                                              "enum" : ["grouped", "separate", "separate-generic"]}
                                                 },
                                  
                                  "anyOf" : [


                                    {"properties" : {"method" : {"const" : "grouped",
                                                                 "description" : "A single preconditioner is used and solve for all variables at the same time"},
                                                     "solverspec" : {"$ref" : "#/$defs/solverspec"}
                                                    }
                                    },

                                    {"properties" : {"method" : {"const" : "separate",
                                                                 "description" : "Separate preconditioners are used for each variable"},
                                                     
                                                     "solvers" : {"type" : "array",
                                                                  "description" : "array of solver specifications for the various variables",
                                                                    "items" : {"type" : "object",
                                                                                "properties" : {"variable" : {"type" : "string",
                                                                                                              "enum" : ["phi", "c", "T"]
                                                                                                             },
                                                                                                "solverspec" : {"$ref" : "#/$defs/solverspec"}
                                                                                               }
                                                                              }
                                                                 }
                                                    }
                                    },
                                    {"properties" : {"method" : {"const" : "separate-generic",
                                                                 "description" : "separate preconditioner - generic form"},
                                                     "solvers" : {"type" : "array",
                                                                  "description" : "array of solver specifications for the various variables",
                                                                  "items" : {"type" : "object",
                                                                             "properties" : {"variables" : {"type" : "array",
                                                                                                            "items" : {"type" : "array",
                                                                                                                       "items" : {"type" : "string"}
                                                                                                                      }
                                                                                                           },
                                                                                             "solverspec" : {"$ref" : "#/$defs/solverspec"}
                                                                                            }
                                                                            }
                                                                 }
                                                    }
                                    }
                                  ]
                                 }
                    }
     
     
    }
  ],

  "$defs" : {"solverspec" : {"type" : "object",
                             "properties" : { "name" : {"type" : "string",
                                                        "enum": ["direct", "agmg", "amgcl"]},
                                              "options" : {"type" : "object"}},
                             "required" : ["name"]
                            }
            }

}





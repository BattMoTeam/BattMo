<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Control models &mdash; BattMo  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_collapse.css" />
      <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />

  
    <link rel="shortcut icon" href="_static/battmologo.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/design-tabs.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Solid Diffusion Models" href="soliddiffusion.html" />
    <link rel="prev" title="The Battery Simulation Model" href="modelinitialisation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            BattMo
              <img src="_static/battmologo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basicusage.html">Basic Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="basicusage.html#a-first-battmo-model">A First <strong>BattMo</strong> Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basicusage.html#define-parameters">Define Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="basicusage.html#run-simulation">Run Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="basicusage.html#show-the-dashboard">Show the Dashboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="basicusage.html#explore-the-output">Explore the Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="basicusage.html#explore-the-grid">Explore the Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="basicusage.html#explore-the-states">Explore the States</a></li>
<li class="toctree-l3"><a class="reference internal" href="basicusage.html#plot-a-result">Plot a Result</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basicusage.html#change-control-parameters">Change Control Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="basicusage.html#change-structural-parameters">Change Structural Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="basicusage.html#change-material-parameters">Change Material Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="basicusage.html#notebooks">Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="basicusage.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="intermediate.html">Intermediate usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intermediate.html#setup-a-p4d-model-using-mergejsonstructs">Setup a P4D Model using <code class="code docutils literal notranslate"><span class="pre">mergeJsonStructs</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="intermediate.html#define-parameters">Define Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="intermediate.html#run-simulation">Run Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="intermediate.html#visualize-results">Visualize Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="intermediate.html#file-links-and-insertions-with-parsebattmojson">File links and insertions with <code class="code docutils literal notranslate"><span class="pre">parseBattmoJson</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">BattMo Model Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="json.html">JSON input specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="json.html#simulation-schema">Simulation Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="json.html#material-parameters">Material Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="json.html#electrolyte">Electrolyte</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html#electrode">Electrode</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html#coating">Coating</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html#active-material">Active Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html#interface">Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html#solid-diffusion">Solid Diffusion</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html#full-solid-diffusion">Full Solid Diffusion</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html#binder">Binder</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html#conducting-additive">Conducting Additive</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html#current-collector">Current Collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html#separator">Separator</a></li>
<li class="toctree-l3"><a class="reference internal" href="json.html#thermal-model">Thermal Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="json.html#geometry-setup">Geometry Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="json.html#simulation-control-parameters">Simulation Control Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="json.html#time-stepping-parameters">Time Stepping Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="json.html#solver-parameters">Solver Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="json.html#output-parameters">Output Parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="geometryinput.html">Battery Geometries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="geometryinput.html#batterygeneratorp2d">BatteryGeneratorP2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometryinput.html#batterygeneratorp3d">BatteryGeneratorP3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometryinput.html#batterygeneratorp4d">BatteryGeneratorP4D</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometryinput.html#spiralbatterygenerator">SpiralBatteryGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometryinput.html#coincellbatterygenerator">CoinCellBatteryGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometryinput.html#batterygeneratormultilayerpouch">BatteryGeneratorMultilayerPouch</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="advancedtopics.html">Advanced Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="modelinitialisation.html">The Battery Simulation Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="modelinitialisation.html#initialisation-of-a-battery-simulation-model">Initialisation of a battery simulation model</a></li>
<li class="toctree-l3"><a class="reference internal" href="modelinitialisation.html#inspection-of-the-model">Inspection of the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="modelinitialisation.html#computing-and-inspecting-some-standard-static-properties-of-the-model">Computing and inspecting some standard static properties of the model</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Control models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#json-input-control-interface">Json input control interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#control-model-description">Control model description</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="soliddiffusion.html">Solid Diffusion Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="parsets.html">Parameter sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="units.html">Units</a><ul>
<li class="toctree-l3"><a class="reference internal" href="units.html#converting-units-in-battmo">Converting units in BattMo</a></li>
<li class="toctree-l3"><a class="reference internal" href="units.html#units-and-json-input">Units and JSON input</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="thermal.html">Thermal Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimisation.html">Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="optimisation.html#parameter-identification-example">Parameter identification example</a></li>
<li class="toctree-l3"><a class="reference internal" href="optimisation.html#optimization-example">Optimization example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="octave.html">Octave</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="juliabridge.html">BattMo Julia bridge</a><ul>
<li class="toctree-l2"><a class="reference internal" href="juliabridge.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="juliabridge.html#start-server">Start Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="juliabridge.html#send-simulation-parameters">Send simulation parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="juliabridge.html#run-the-simulation">Run the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="juliabridge.html#post-process-the-output">Post process the output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="publishedExamples/runElectrolyser.html">Electrolyser simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="publishedExamples/runElectrolyser.html#setup-input">Setup input</a></li>
<li class="toctree-l2"><a class="reference internal" href="publishedExamples/runElectrolyser.html#setup-model">Setup model</a></li>
<li class="toctree-l2"><a class="reference internal" href="publishedExamples/runElectrolyser.html#setup-the-initial-condition">Setup the initial condition</a></li>
<li class="toctree-l2"><a class="reference internal" href="publishedExamples/runElectrolyser.html#setup-the-schedule-with-the-time-discretization">Setup the schedule with the time discretization</a></li>
<li class="toctree-l2"><a class="reference internal" href="publishedExamples/runElectrolyser.html#setup-the-non-linear-solver">Setup the non-linear solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="publishedExamples/runElectrolyser.html#run-the-simulation">Run the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="publishedExamples/runElectrolyser.html#visualize-the-results">Visualize the results</a></li>
<li class="toctree-l2"><a class="reference internal" href="publishedExamples/runElectrolyser.html#ph-distribution-plot">pH distribution plot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="protonicmembrane.html">Protonic Membrane</a><ul>
<li class="toctree-l2"><a class="reference internal" href="publishedExamples/runProtonicMembrane.html">Protonic Membrane</a><ul>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicMembrane.html#model-overview">Model overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="publishedExamples/runProtonicMembrane.html#governing-equations">Governing equations</a></li>
<li class="toctree-l4"><a class="reference internal" href="publishedExamples/runProtonicMembrane.html#boundary-conditions">Boundary conditions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicMembrane.html#load-and-parse-input-from-given-json-files">Load and parse input from given json files</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicMembrane.html#input-structure-setup">Input structure setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicMembrane.html#model-setup">Model setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicMembrane.html#initial-state-setup">Initial state setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicMembrane.html#schedule">Schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicMembrane.html#simulation">Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicMembrane.html#plotting">Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicMembrane.html#evolution-of-the-faradic-efficiency">Evolution of the Faradic efficiency</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="publishedExamples/runGasSupply.html">Gas Supply</a><ul>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runGasSupply.html#model-overview">Model overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="publishedExamples/runGasSupply.html#governing-equations">Governing equations</a></li>
<li class="toctree-l4"><a class="reference internal" href="publishedExamples/runGasSupply.html#boundary-conditions">Boundary conditions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runGasSupply.html#json-input-data">json input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runGasSupply.html#input-parameter-setup">Input parameter setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runGasSupply.html#model-setup">Model setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runGasSupply.html#model-plot">Model Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runGasSupply.html#setup-initial-state">Setup initial state</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runGasSupply.html#schedule-setup">Schedule setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runGasSupply.html#simulation">Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runGasSupply.html#result-plots">Result plots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="publishedExamples/runProtonicCell.html">Full Cell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicCell.html#json-input-data">json input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicCell.html#input-parameter-setup">Input parameter setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicCell.html#model-setup">Model setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicCell.html#grid-plots">Grid plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicCell.html#setup-initial-state">Setup initial state</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicCell.html#setup-schedule">Setup schedule</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicCell.html#setup-nonlinear-solver">Setup nonlinear solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicCell.html#start-simulation">Start simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicCell.html#plotting-setup">plotting setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicCell.html#electrolyte-results">Electrolyte results</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicCell.html#gas-layer-results">Gas Layer results</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishedExamples/runProtonicCell.html#interface-results">Interface results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="app.html">BattMoApp</a><ul>
<li class="toctree-l2"><a class="reference internal" href="app_features.html">Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="app_features.html#utilize-default-materials">Utilize Default Materials</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_features.html#customize-with-your-own-materials">Customize with Your Own Materials</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_features.html#visualize-your-battery-geometry">Visualize Your Battery Geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_features.html#download-input-data">Download Input Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_features.html#upload-input-data">Upload Input Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_features.html#visualize-and-download-results">Visualize and Download Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_features.html#upload-your-previous-results">Upload your previous results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="app_troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="app_unnatural_artifacts.html">Unnatural artifacts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="app_unnatural_artifacts.html#discritization-issues">Discritization issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="app_unsuccessful_simulation.html">Unsuccessful simulation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="app_unsuccessful_simulation.html#using-lifepo4-datasets">Using LiFePO4 datasets</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="computationalGraph/graphdoc.html">Computational Graph</a><ul>
<li class="toctree-l2"><a class="reference internal" href="computationalGraph/graphdoc.html#a-simple-introduction-example">A simple introduction example</a></li>
<li class="toctree-l2"><a class="reference internal" href="computationalGraph/graphdoc.html#graph-composition">Graph composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="computationalGraph/graphdoc.html#graph-setup-and-implementation">Graph Setup and Implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="seealso.html">See Also</a><ul>
<li class="toctree-l2"><a class="reference internal" href="seealso.html#mrst">MRST</a><ul>
<li class="toctree-l3"><a class="reference internal" href="seealso.html#visualization">Visualization Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="seealso.html#id2">Grid Factory Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="seealso.html#fair-data">FAIR Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BattMo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="advancedtopics.html">Advanced Usage</a></li>
      <li class="breadcrumb-item active">Control models</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/controlinput.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="control-models">
<h1>Control models<a class="headerlink" href="#control-models" title="Permalink to this heading"></a></h1>
<p>The battery <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/Battery/Battery.m#L19">model</a> contains a <em>Control</em> sub-model, see the overall model structure
<a class="reference internal" href="architecture.html#battmo-model-architecture"><span class="std std-ref">description</span></a>. The Control model determine the control <em>values</em> and <em>type</em>.</p>
<p>At a <strong>given time</strong>, there are in general two control types:</p>
<ul class="simple">
<li><p>Total current</p></li>
<li><p>Voltage</p></li>
</ul>
<p>Given a control type, the control <em>value</em> can change in time. For the most standard control types, the json interface
can be used. We plan to include there more control models. Below, we give some short explanations on how a control model
can be implemented.</p>
<section id="json-input-control-interface">
<h2>Json input control interface<a class="headerlink" href="#json-input-control-interface" title="Permalink to this heading"></a></h2>
<p>The most standard controls can be called from BattMo using the json interface:</p>
<ul class="simple">
<li><p>Constant Current Discharge (CCDischarge)</p></li>
<li><p>Constant Current Charge (CCCharge)</p></li>
<li><p>Constant Current Constant Voltage (CCCV)</p></li>
</ul>
<p>The parameters for each of the model are described in the json schema <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/Utilities/JsonSchemas/ControlModel.schema.json">ControlModel.schema.json</a>. Let us review them by looking at examples. For all controls, we have
a given <code class="code docutils literal notranslate"><span class="pre">CRate</span></code>. The property <code class="code docutils literal notranslate"><span class="pre">controlPolicy</span></code> is used to set the control model.</p>
<p><strong>Constant Current Discharge</strong></p>
<p>Before the simulation starts, the capacity of the battery is computed. The battery capacity value is used to compute the
given input current from the CRate value. For a constant current discharge, we have a lower cutoff voltage where the
simulation stops.  The parameter <code class="code docutils literal notranslate"><span class="pre">useCVswitch</span></code> can be used if we want to continue the simulation until a given
fixed time, by switching to voltage control. At the start of the simulation, strong non-linearities in the equations may
create difficulties to reach the activation potential. For this reason, there is the possibility to use a <em>rampup time</em>
where the current is gradually increased from zero to the targeted given input current.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&quot;Control&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;controlPolicy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CCDischarge&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;rampupTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;CRate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;lowerCutoffVoltage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">2.4</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For the dataset given <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ParameterData/BatteryCellParameters/LithiumIonBatteryCell/lithium_ion_battery_nmc_graphite.json">here</a>, we obtain the
following result.</p>
<figure class="align-center" id="id1">
<a class="reference external image-reference" href="_images/controlExampleCCDischarge.png"><img alt="_images/controlExampleCCDischarge.png" src="_images/controlExampleCCDischarge.png" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text">Constant Current Discharge control</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p><strong>Constant Current Charge</strong></p>
<p>In the same way as the discharge case, the capacity of the battery is computed first to set the given input current from
the CRate. When the upper cuttoff voltage limit is reached, the control type is switched to voltage control. Also in
this case, we can include a rampup time. As an example,</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&quot;Control&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;controlPolicy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CCCharge&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;rampupTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;CRate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;upperCutoffVoltage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">4.1</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For the dataset given <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ParameterData/BatteryCellParameters/LithiumIonBatteryCell/lithium_ion_battery_nmc_graphite.json">here</a>, we obtain the
following result.</p>
<figure class="align-center" id="id2">
<a class="reference external image-reference" href="_images/controlExampleCCCharge.png"><img alt="_images/controlExampleCCCharge.png" src="_images/controlExampleCCCharge.png" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text">Constant Current Charge control</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p><strong>Constant Current Constant Charge</strong></p>
<p>An example of input is</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&quot;Control&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;controlPolicy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CCCV&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;CRate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;initialControl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;discharging&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;numberOfCycles&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;lowerCutoffVoltage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">2.4</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;upperCutoffVoltage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">4.1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;dIdtLimit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1e-5</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;dEdtLimit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1e-5</span>
<span class="p">},</span>
</pre></div>
</div>
<p>The control type and value are set following the following procedure. In the case above, we start by discharging</p>
<ol class="arabic simple">
<li><p>We use a constant discharge current computed from the capacity and the given CRate. We keep this value until the
lower cutoff voltage value is reached. Then, we switch to step 2.</p></li>
<li><p>The control is set to zero. At each time step we compute the time derivative of the voltage
<span class="math notranslate nohighlight">\(\frac{dE}{dt}\)</span>. When this value reach the limit given by <code class="code docutils literal notranslate"><span class="pre">dEdtLimit</span></code>. We start the charge step 3.</p></li>
<li><p>We use a constant charge current. The value is the same as in step 1, with opposite sign. We keep this current until
the lower cutoff voltage limit is reached. Then we switch to constant voltage control step 4.</p></li>
<li><p>We use a constant voltage given by the cutoff value and monitor the current derivative <span class="math notranslate nohighlight">\(\frac{dI}{dt}\)</span>. When
this value is lower than <code class="code docutils literal notranslate"><span class="pre">dIdtLimit</span></code>, we start again the discharge by going to step 1.</p></li>
</ol>
<p>We iterate this process for the given number of cycles. For the dataset given <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/ParameterData/BatteryCellParameters/LithiumIonBatteryCell/lithium_ion_battery_nmc_graphite.json">here</a>, we obtain the
following result.</p>
<figure class="align-center" id="id3">
<a class="reference external image-reference" href="_images/controlExampleCCCV.png"><img alt="_images/controlExampleCCCV.png" src="_images/controlExampleCCCV.png" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text">CCCV control</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The script used to generate the figures is available <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/Examples/Documentation/plotControlExamples_doc.m">here</a>.</p>
</section>
<section id="control-model-description">
<h2>Control model description<a class="headerlink" href="#control-model-description" title="Permalink to this heading"></a></h2>
<p>Beside json input, the function <a class="reference external" href="https://github.com/SINTEF-AppliedCompSci/MRST/blob/battmo/mrst-autodiff/ad-core/simulators/simulateScheduleAD.m">simulateScheduleAD</a> is used to run a simulation. It requires</p>
<ul class="simple">
<li><p>A <strong>model</strong>, which knows how to setup and solve the governing equations of our problem,</p></li>
<li><p>An <strong>initial state</strong>,</p></li>
<li><p>A <strong>schedule</strong>, which provides the time stepping and can also contain setup for control</p></li>
</ul>
<p>The <code class="code docutils literal notranslate"><span class="pre">schedule</span></code> contains two fields</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">control</span></code>: It is a struct array containing fields that the model knows how to process.  Typically, this
will be the fields such as <cite>src</cite> for input current.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">step</span></code>: It contains two arrays of equal size named <code class="code docutils literal notranslate"><span class="pre">val</span></code> and <code class="code docutils literal notranslate"><span class="pre">control</span></code>. Control is a index into the
<code class="code docutils literal notranslate"><span class="pre">schedule.control</span></code> array, indicating which control is to be used for the timestep. <code class="code docutils literal notranslate"><span class="pre">schedule.step.val</span></code> is the
timestep used for that control step.</p></li>
</ul>
<p>Let us set up a control with a given current control source function. In this case, we choose a sinusoidal current
control.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="o">*</span><span class="nb">second</span><span class="p">;</span>
<span class="n">T</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="nb">minute</span><span class="p">;</span>
<span class="n">N</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">;</span>

<span class="nb">step</span><span class="p">.</span><span class="n">val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dt</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="nb">step</span><span class="p">.</span><span class="n">control</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="n">period</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="o">*</span><span class="nb">minute</span><span class="p">;</span>
<span class="n">control</span><span class="p">.</span><span class="n">src</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">@(</span><span class="nb">time</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mf">1e-2</span><span class="o">*</span><span class="n">ampere</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="o">*</span><span class="nb">time</span><span class="o">/</span><span class="n">period</span><span class="p">));</span>
<span class="n">control</span><span class="p">.</span><span class="n">CC</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>

<span class="n">schedule</span><span class="p">.</span><span class="n">step</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">step</span><span class="p">;</span>
<span class="n">schedule</span><span class="p">.</span><span class="n">control</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">control</span><span class="p">;</span>
</pre></div>
</div>
<p>We have to setup a model and an initial state. We use the function <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/Utilities/JsonUtils/setupModelFromJson.m">setupModelFromJson</a> to setup the model from
a given json input. We load the sample input function we have used before, see source
<a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/Examples/JsonDataFiles/sample_input.json">here</a>. We replace the <code class="code docutils literal notranslate"><span class="pre">Control</span></code> field with a structure with
a <code class="code docutils literal notranslate"><span class="pre">controlPolicy</span></code> given by a current control (<code class="code docutils literal notranslate"><span class="pre">CC</span></code>). We change the initial state of charge value (SOC) to
0.5 so that we do not hit the upper current voltage value (the SOC given in the sample json is 0.99).</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">jsonstruct</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parseBattmoJson</span><span class="p">(</span><span class="s">&#39;Examples/jsondatafiles/sample_input.json&#39;</span><span class="p">);</span>

<span class="n">jsonstruct</span><span class="p">.</span><span class="n">Control</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span>
<span class="n">jsonstruct</span><span class="p">.</span><span class="n">Control</span><span class="p">.</span><span class="n">controlPolicy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;CC&#39;</span><span class="p">;</span>

<span class="n">jsonstruct</span><span class="p">.</span><span class="n">SOC</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>

<span class="n">model</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">setupModelFromJson</span><span class="p">(</span><span class="n">jsonstruct</span><span class="p">);</span>
</pre></div>
</div>
<p>We use the default state initialisation method given by the method <code class="code docutils literal notranslate"><span class="pre">setupInitialState</span></code> in the <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/Battery/Battery.m">Battery</a> model.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">initstate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">setupInitialState</span><span class="p">(</span><span class="n">jsonstruct</span><span class="p">);</span>
</pre></div>
</div>
<p>Now, we can run the simulation for the given schedule, model and initial state using <a class="reference external" href="https://github.com/SINTEF-AppliedCompSci/MRST/blob/battmo/mrst-autodiff/ad-core/simulators/simulateScheduleAD.m">simulateScheduleAD</a></p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="w"> </span><span class="n">states</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">simulateScheduleAD</span><span class="p">(</span><span class="n">initstate</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">schedule</span><span class="p">);</span>
</pre></div>
</div>
<p>The complete source can be found here <a class="reference external" href="https://github.com/BattMoTeam/BattMo/blob/main/Examples/Documentation/exampleControl_doc.m">exampleControl_doc</a>.</p>
<figure class="align-center">
<a class="reference external image-reference" href="_images/exampleControl.png"><img alt="_images/exampleControl.png" src="_images/exampleControl.png" style="width: 70%;" /></a>
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modelinitialisation.html" class="btn btn-neutral float-left" title="The Battery Simulation Model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="soliddiffusion.html" class="btn btn-neutral float-right" title="Solid Diffusion Models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>